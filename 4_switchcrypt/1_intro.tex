\section{Introduction}\label{sec:introduction}

The state of the art for securing data at rest, such as the contents of a
laptop's SSD, is Full Drive Encryption (FDE). Traditional FDE employs a single
cryptographic cipher to encrypt, decrypt, and authenticate drive contents on the
fly. Unfortunately, encryption introduces overhead which can drastically impact
system performance and total energy consumption. Hence, modern storage systems
must carefully balance these competing concerns. On the one hand, stronger
security guarantees come with increased latency and threaten to balloon energy
consumption. On the other, capping total energy consumption requires tolerating
increased latency or weaker security guarantees.

FDE implementations such as dm-crypt for Linux and BitLocker for Windows balance
these concerns with respect to some generic ``common case'' workload, but
this approach often fails to deliver an optimal outcome for specific workloads.
Google's Android OS is a good example of this. Android supported FDE with the
release of Android 3.0, yet it was not enabled by default until Android
6.0~\cite{android-M-mobile-motivation}. Two years prior, Google attempted to
roll out FDE by default on Android 5.0 but had to backtrack. In a statement to
Engadget, Google blamed ``'performance issues on some partner devices' ... for
the backtracking''~\cite{google-engadget}. At the same time, AnandTech reported
a ``62.9\% drop in random read performance, a 50.5\% drop in random write
performance, and a staggering 80.7\% drop in sequential read performance''
versus Android 5.0 unencrypted storage for various
workloads~\cite{android-M-mobile-motivation-2}.

FDE's impact on drive performance and energy efficiency depends on a multitude
of choices. Paramount among them is the choice of cipher, as different ciphers
expose different performance and energy efficiency characteristics. In this way,
cipher choice can be viewed as a key \emph{configuration parameter} for FDE
systems. The benefits of choosing one cipher over another might include: 1)
improved performance (\ie{overall reduction in FDE overhead}), 2) reduced energy
use, 3) more useful security guarantees, and 4) the ability to encrypt devices
that would otherwise be too slow or energy-inefficient to support FDE.

However, the standard cipher choice for FDE is the slow AES \emph{block cipher}
(AES-XTS)~\cite{XTS, XTSComments, NISTXTS}. Dickens et al. introduced a method
for using ciphers other than AES-XTS for FDE; specifically, the high performance
ChaCha20 \emph{stream cipher}~\cite{StrongBox, ChaCha20}. More recent
work---such as Google's HBSH (hash, block cipher, stream cipher, hash) and
Adiantum---brings stream cipher based FDE to devices that do not or cannot
support hardware accelerated AES~\cite{Adiantum}. Hence, it has been
demonstrated that using stream ciphers for FDE is not only feasible at industry
scale but is desirable in a variety of contexts.

In this paper, we explore the rich configuration space of stream ciphers beyond
the narrow scope of previous work. Each cipher comes with a variety of
performance, energy efficiency, and security properties in the FDE context.
These ciphers include ChaCha variants with different round counts (e.g., ChaCha8
and ChaCha12), ciphers with stronger security guarantees versus more robust
adversaries (e.g., Freestyle), and other ciphers like SalsaX, AES in counter
mode (AES-CTR), Rabbit, Sosemanuk, etc~\cite{Freestyle, SalsaX, Rabbit,
Sosemanuk, ChaCha20, AESCTR}. Given this space, the cipher configuration
providing the least latency overhead is almost always different than the
configuration providing the most desirable security properties, and both may
differ from the configuration using the least energy or preserving the most free
space on the encrypted drive.

Further, while cipher choice might be configured statically at compile or boot
time with respect to some common case in traditional FDE, such configurations
cannot dynamically adapt to changes that arise while the system is running.
Examples include changes in resource availability, runtime environment, desired
security properties, and respecting changing OS energy budgets.

Hence, any static common-case FDE configuration will sacrifice one concern for
another, even when it is not optimal to do so for a given workload. But what if
a system could dynamically transition into a more desirable configuration given
runtime changes?\\
\\
\textbf{Our Contributions}\\
To realize the goal of dynamically adjusting storage tradeoffs at runtime, we
first define a scheme to \emph{quantify} the usefulness of each cipher based on
key security properties relevant to FDE in context. Using this scheme, we define
a tradeoff space of cipher configurations over competing concerns: total energy
use, desirable security properties, read and write performance (latency), total
writable space on the drive, and how quickly the contents of the drive can
converge to a single encryption configuration. We then introduce a novel design
substantively expanding prior FDE work by wholly \emph{decoupling} cipher
implementations from the encryption process. Finally, we develop the idea of
cipher switching using \emph{switching strategies} to ``re-cipher'' storage
units dynamically, allowing us to tradeoff different performance and security
properties of various configurations at runtime.

Unifying these contributions, we present SwitchCrypt, a software mechanism that
navigates the tradeoff space made by balancing competing security and latency
requirements via cipher switching in space and time. We implement SwitchCrypt
and three switching strategies---\emph{Forward}, \emph{Selective}, and
\emph{Mirrored}---to dynamically transition the system between configurations
using our generic cipher interface. We then study the utility of cipher
switching through four case studies where latency, energy, and desired security
properties change over time.

In one study, where we require the filesystem to react to a shrinking energy
budget by switching ciphers, we find that SwitchCrypt achieves up to a 3.3x
total energy use reduction compared to prior static approaches that only use the
Freestyle stream cipher without switching. In another case, where we allow the
user to manually switch between ChaCha20 and Freestyle stream ciphers
dynamically, we achieve a 3.1x to 4.8x reduction to read latency and 1.6x to
2.8x reduction to write latency compared to prior static approaches.

We make the SwitchCrypt source publicly available open
source\footnote{\label{note1}\SystemURI}.
